<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Track Packages - FedEx</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'fedex-purple': '#4D148C',
            'fedex-orange': '#FF6200',
            'fedex-gray': '#767676',
            'fedex-light-gray': '#F5F5F5',
            'fedex-dark-gray': '#333333',
            'fedex-blue': '#0071CE',
            'fedex-green': '#6CBF00'
          },
          fontFamily: {
            'fedex': ['Source Sans Pro', 'Arial', 'sans-serif']
          }
        }
      }
    }
  </script>

  <style>
    * {
      font-family: 'Source Sans Pro', Arial, sans-serif;
    }
    .fedex-shadow { box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .fedex-button { background: #4D148C; transition: all 0.3s ease; }
    .fedex-button:hover { background: #3D0F6B; transform: translateY(-1px); }
    .progress-bar { background: linear-gradient(90deg, #FF6200, #4D148C); transition: width 2s ease-in-out; }
    .modal-backdrop { backdrop-filter: blur(4px); }
    .page-section, .modal { display: none; }
    .page-section.active, .modal.active { display: flex; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 0.5s ease-out; }
    
    .notification { position: fixed; top: 20px; right: 20px; padding: 1rem 1.5rem; border-radius: 8px; color: white; font-weight: 600; z-index: 10001; animation: slideInRight 0.5s ease-out; max-width: 350px; }
    .notification.success { background: #059669; }
    .notification.error { background: #DC2626; }
    @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

    .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #FF6200; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Admin Dashboard Styles */
    #admin-dashboard { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #F5F5F5; z-index: 9999; overflow-y: auto; transition: opacity 0.3s ease; display: none; }
    .admin-form-section { display: none; }
    .admin-form-section.active { display: block; animation: fadeIn 0.5s ease-out; }
    .admin-table-container { overflow-x: auto; }
    .admin-table { width: 100%; min-width: 800px; border-collapse: collapse; }
    .admin-table th, .admin-table td { padding: 12px 16px; border-bottom: 1px solid #ddd; text-align: left; }
    .admin-table th { background-color: #e9e9e9; font-weight: 600; color: #333; }
    .admin-table tr:hover { background-color: #f0f0f0; }
    .admin-input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; transition: border-color 0.3s; }
    .admin-input:focus { border-color: #4D148C; outline: none; }
    .admin-label { font-weight: 600; margin-bottom: 6px; display: block; }
    .admin-nav-button { padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all 0.3s; cursor: pointer; }
    .admin-nav-button.active { background-color: #4D148C; color: white; }
    .admin-nav-button:not(.active) { color: #333; background-color: white; }
    
    .service-card { transition: all 0.3s ease; cursor: pointer; }
    .service-card:hover { transform: translateY(-4px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
  </style>
</head>

<body class="bg-white font-fedex">
  <!-- Header -->
  <header class="bg-white border-b border-gray-200 sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div id="fedex-logo" class="flex items-center cursor-pointer" onclick="handleLogoClick()">
          <div class="bg-fedex-purple text-white px-3 py-2 font-bold text-2xl">Fed</div>
          <div class="bg-fedex-orange text-white px-3 py-2 font-bold text-2xl">Ex</div>
        </div>
        <nav class="hidden lg:flex space-x-8">
          <a href="#" class="text-fedex-dark-gray hover:text-fedex-purple font-semibold" onclick="showModal('ship-modal')">Ship</a>
          <a href="#" class="text-fedex-purple font-semibold border-b-2 border-fedex-orange pb-3" onclick="showPage('main-page')">Track</a>
          <a href="#" class="text-fedex-dark-gray hover:text-fedex-purple font-semibold" onclick="showModal('manage-modal')">Manage</a>
          <a href="#" class="text-fedex-dark-gray hover:text-fedex-purple font-semibold" onclick="showModal('support-modal')">Support</a>
        </nav>
        <button class="lg:hidden p-2" onclick="toggleMobileMenu()"><i class="fas fa-bars text-2xl text-fedex-dark-gray"></i></button>
      </div>
    </div>
  </header>
  
  <!-- Main Content Container -->
  <div id="content-container">
    <div id="main-page" class="page-section active">
      <main class="bg-fedex-light-gray">
        <!-- Hero Section -->
        <section class="bg-white py-12">
          <div class="max-w-6xl mx-auto px-4">
            <div class="text-center mb-8">
              <h1 class="text-4xl lg:text-5xl font-bold text-fedex-dark-gray mb-4">Track Your Package</h1>
              <p class="text-xl text-fedex-gray">Enter your tracking number for real-time updates</p>
            </div>
            <div class="max-w-2xl mx-auto">
              <div class="bg-white border border-gray-200 rounded-lg fedex-shadow p-6">
                <form id="tracking-form">
                  <div class="relative">
                    <input type="text" id="tracking-number" required class="w-full px-4 py-4 text-lg border-2 border-gray-300 rounded-lg focus:border-fedex-purple focus:outline-none" placeholder="e.g., FD26031998KR">
                    <button type="submit" id="track-button" class="absolute right-2 top-2 fedex-button text-white px-6 py-2 rounded-lg font-semibold">
                      <span id="track-text">Track</span>
                      <span id="track-loading" class="hidden"><div class="loading-spinner"></div></span>
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </section>

        <!-- Services Section -->
        <section class="py-16">
          <div class="max-w-6xl mx-auto px-4">
            <h2 class="text-3xl font-bold text-fedex-dark-gray text-center mb-10">Our Services</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
              <div class="service-card bg-white rounded-lg fedex-shadow p-8 text-center" onclick="showModal('ship-modal')">
                <div class="w-20 h-20 bg-fedex-purple rounded-full flex items-center justify-center mx-auto mb-5"><i class="fas fa-shipping-fast text-white text-3xl"></i></div>
                <h3 class="text-2xl font-bold text-fedex-dark-gray mb-3">Ship</h3>
                <p class="text-fedex-gray">Create shipping labels, schedule pickups, and manage your shipments effortlessly.</p>
              </div>
              <div class="service-card bg-white rounded-lg fedex-shadow p-8 text-center" onclick="showPage('main-page')">
                <div class="w-20 h-20 bg-fedex-orange rounded-full flex items-center justify-center mx-auto mb-5"><i class="fas fa-search-location text-white text-3xl"></i></div>
                <h3 class="text-2xl font-bold text-fedex-dark-gray mb-3">Track</h3>
                <p class="text-fedex-gray">Monitor your shipments in real-time from origin to destination with detailed updates.</p>
              </div>
              <div class="service-card bg-white rounded-lg fedex-shadow p-8 text-center" onclick="showModal('manage-modal')">
                <div class="w-20 h-20 bg-fedex-blue rounded-full flex items-center justify-center mx-auto mb-5"><i class="fas fa-cog text-white text-3xl"></i></div>
                <h3 class="text-2xl font-bold text-fedex-dark-gray mb-3">Manage</h3>
                <p class="text-fedex-gray">Access your shipping history, manage delivery options, and set preferences.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Delivery Insights Section -->
        <section class="py-16 bg-white">
          <div class="max-w-6xl mx-auto px-4">
            <h2 class="text-3xl font-bold text-fedex-dark-gray text-center mb-10">Connecting the World</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-white">
              <div class="bg-gradient-to-br from-fedex-purple to-indigo-600 rounded-lg p-8">
                <i class="fas fa-truck text-4xl opacity-75 mb-4"></i>
                <p class="text-5xl font-bold mb-2">15M+</p>
                <h3 class="text-xl font-bold">Daily Deliveries</h3>
                <p class="opacity-90">Packages delivered worldwide every day.</p>
              </div>
              <div class="bg-gradient-to-br from-fedex-orange to-red-500 rounded-lg p-8">
                <i class="fas fa-check-circle text-4xl opacity-75 mb-4"></i>
                <p class="text-5xl font-bold mb-2">99.2%</p>
                <h3 class="text-xl font-bold">On-Time Rate</h3>
                <p class="opacity-90">Industry-leading delivery performance.</p>
              </div>
              <div class="bg-gradient-to-br from-fedex-green to-teal-600 rounded-lg p-8">
                <i class="fas fa-globe-americas text-4xl opacity-75 mb-4"></i>
                <p class="text-5xl font-bold mb-2">220+</p>
                <h3 class="text-xl font-bold">Countries Served</h3>
                <p class="opacity-90">A truly global transportation network.</p>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- All Modals (Initially Hidden) -->
  <div id="tracking-modal" class="modal fixed inset-0 bg-black bg-opacity-50 modal-backdrop items-center justify-center z-50 p-2">
    <div class="bg-white rounded-lg w-full max-w-7xl max-h-[95vh] overflow-y-auto animate-fade-in">
      <div class="bg-fedex-purple text-white p-6 rounded-t-lg sticky top-0 z-10 flex justify-between items-center">
        <div>
          <h2 class="text-2xl font-bold">Tracking Details</h2>
          <p class="text-fedex-orange font-semibold" id="modal-tracking-number"></p>
        </div>
        <button onclick="closeModal('tracking-modal')" class="text-2xl"><i class="fas fa-times"></i></button>
      </div>
      <div class="p-6" id="modal-content"></div>
    </div>
  </div>

  <div id="ship-modal" class="modal fixed inset-0 bg-black bg-opacity-50 modal-backdrop items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg max-w-lg w-full animate-fade-in">
        <div class="p-6 flex justify-between items-center border-b">
            <h2 class="text-2xl font-bold text-fedex-purple">Create a Shipment</h2>
            <button onclick="closeModal('ship-modal')" class="text-2xl text-gray-500">×</button>
        </div>
        <div class="p-6">
            <p>This is where the shipment creation flow would begin. For this simulation, you can create new shipments from the Admin Dashboard.</p>
            <button onclick="closeModal('ship-modal'); handleLogoClick();" class="mt-4 fedex-button text-white w-full py-3 rounded-lg font-semibold">Go to Admin Dashboard</button>
        </div>
    </div>
  </div>
  
  <div id="manage-modal" class="modal fixed inset-0 bg-black bg-opacity-50 modal-backdrop items-center justify-center z-50 p-4">
     <div class="bg-white rounded-lg max-w-lg w-full animate-fade-in">
        <div class="p-6 flex justify-between items-center border-b">
            <h2 class="text-2xl font-bold text-fedex-purple">Manage Deliveries</h2>
            <button onclick="closeModal('manage-modal')" class="text-2xl text-gray-500">×</button>
        </div>
        <div class="p-6">
            <p>Here you could view your shipping history, set delivery preferences, and manage returns. This functionality is available in the Admin Dashboard for this simulation.</p>
        </div>
    </div>
  </div>
  
  <div id="support-modal" class="modal fixed inset-0 bg-black bg-opacity-50 modal-backdrop items-center justify-center z-50 p-4">
     <div class="bg-white rounded-lg max-w-lg w-full animate-fade-in">
        <div class="p-6 flex justify-between items-center border-b">
            <h2 class="text-2xl font-bold text-fedex-purple">Customer Support</h2>
            <button onclick="closeModal('support-modal')" class="text-2xl text-gray-500">×</button>
        </div>
        <div class="p-6 space-y-4">
            <p>Get help with shipments, accounts, and services.</p>
            <p><i class="fas fa-phone mr-2 text-fedex-orange"></i> 1-800-Go-FedEx (1-800-463-3339)</p>
            <p><i class="fas fa-comments mr-2 text-fedex-orange"></i> Live Chat available 24/7</p>
        </div>
    </div>
  </div>
  
  <div id="admin-login-modal" class="modal fixed inset-0 bg-black bg-opacity-50 modal-backdrop items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg max-w-sm w-full animate-fade-in shadow-xl">
        <div class="p-6 border-b">
            <h2 class="text-2xl font-bold text-fedex-purple text-center">Admin Login</h2>
        </div>
        <form id="admin-login-form" class="p-8 space-y-6">
            <div>
                <label for="admin-username" class="admin-label">Username</label>
                <input type="text" id="admin-username" class="admin-input" required value="admin">
            </div>
            <div>
                <label for="admin-password" class="admin-label">Password</label>
                <input type="password" id="admin-password" class="admin-input" required value="admin111">
            </div>
            <p id="login-error-msg" class="text-red-500 text-sm hidden">Invalid credentials. Please try again.</p>
            <div class="flex space-x-4">
                 <button type="button" onclick="closeModal('admin-login-modal')" class="w-1/2 border border-gray-400 text-gray-700 py-3 rounded-lg font-semibold">Cancel</button>
                <button type="submit" class="w-1/2 fedex-button text-white py-3 rounded-lg font-semibold">Login</button>
            </div>
        </form>
    </div>
  </div>


  <!-- ADMIN DASHBOARD (Initially Hidden) -->
  <div id="admin-dashboard">
    <div class="p-4 sm:p-8 max-w-7xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-fedex-purple">Admin Dashboard</h1>
            <button onclick="hideAdminDashboard()" class="text-2xl text-gray-500 hover:text-fedex-orange">×</button>
        </div>

        <div class="flex space-x-2 mb-8 border-b">
            <button id="admin-nav-shipments" class="admin-nav-button active" onclick="showAdminSection('admin-shipments-section')">Shipments</button>
            <button id="admin-nav-security" class="admin-nav-button" onclick="showAdminSection('admin-security-section')">Security</button>
        </div>

        <div id="admin-shipments-section" class="admin-form-section active">
            <div id="admin-table-view">
                 <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-fedex-dark-gray mb-4 sm:mb-0">All Shipments</h2>
                    <button id="show-create-form-btn" class="fedex-button text-white px-5 py-2 rounded-lg font-semibold"><i class="fas fa-plus mr-2"></i>Create Shipment</button>
                </div>
                <div class="bg-white rounded-lg shadow-md p-4 admin-table-container">
                    <table class="admin-table" id="shipments-table">
                        <thead><tr><th>Tracking #</th><th>Status</th><th>From</th><th>To</th><th>Service</th><th>Actions</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div id="admin-form-view" class="hidden">
                 <h2 id="form-title" class="text-2xl font-semibold text-fedex-dark-gray mb-6">Create New Shipment</h2>
                 <form id="shipment-form" class="bg-white rounded-lg shadow-md p-6 space-y-6"></form>
            </div>
        </div>

        <div id="admin-security-section" class="admin-form-section">
            <h2 class="text-2xl font-semibold text-fedex-dark-gray mb-6">Change Password</h2>
            <div class="bg-white rounded-lg shadow-md p-8 max-w-lg mx-auto">
                <form id="password-change-form" class="space-y-6">
                    <div>
                        <label for="current-password" class="admin-label">Current Password</label>
                        <input type="password" id="current-password" class="admin-input" required>
                    </div>
                     <div>
                        <label for="new-password" class="admin-label">New Password</label>
                        <input type="password" id="new-password" class="admin-input" required>
                    </div>
                     <div>
                        <label for="confirm-password" class="admin-label">Confirm New Password</label>
                        <input type="password" id="confirm-password" class="admin-input" required>
                    </div>
                    <button type="submit" class="w-full fedex-button text-white py-3 rounded-lg font-semibold">Update Password</button>
                </form>
            </div>
        </div>
    </div>
  </div>

  <script>
    // --- APPLICATION STATE & DATABASE ---
    const AppState = {
        adminCredentials: { username: 'admin', password: 'admin111' },
        logoClickCount: 0,
        logoClickTimer: null
    };

    const trackingDatabase = {
      'FD26031998KR': {
        trackingNumber: 'FD26031998KR', status: 'Awaiting Clearance', service: 'FedEx International Priority', currentLocation: 'FedEx Office Paris, France', estimatedDelivery: 'Pending clearance approval', shipDate: 'June 22, 2025', weight: '2,840 lbs', dimensions: '72" x 84" x 48"', declaredValue: '$424,000.00', progress: 20, requiresClearance: true,
        sender: { name: 'Keanu Reeves', company: 'FedEx Office Paris', address: '15 Rue de la Paix', city: '75001 Paris, France', phone: '+33 1 42 61 50 50' },
        recipient: { name: 'Kavita Dinanauth', address: '2103 Belladora Road', city: 'Conway, SC 29527, USA', phone: '(843) 555-0123', email: 'fedexpressdeliveryservices231@gmail.com' },
        timeline: [
          { status: 'Awaiting recipient clearance', location: 'PARIS, FR', date: 'June 22, 2025', time: '1:45 PM', description: 'Package registered at FedEx Office Paris. Awaiting recipient clearance.'},
          { status: 'Registered at FedEx facility', location: 'PARIS, FR', date: 'June 22, 2025', time: '1:45 PM', description: 'High-value package registered and secured.'}
        ]
      }
    };

    // --- UTILITY & CORE FUNCTIONS ---
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `<span>${message}</span>`;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 4000);
    }

    function showPage(pageId) {
      document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId)?.classList.add('active');
    }

    function showModal(modalId) {
      document.getElementById(modalId)?.classList.add('active');
    }

    function closeModal(modalId) {
      document.getElementById(modalId)?.classList.remove('active');
    }

    // --- FRONTEND TRACKING LOGIC ---
    function trackPackage(trackingNumber) {
      const data = trackingDatabase[trackingNumber.toUpperCase()];
      if (data) {
        displayTrackingModal(data);
        return true;
      }
      return false;
    }

    function displayTrackingModal(data) {
        // Ensure timeline has an `isLatest` flag
        data.timeline.forEach((event, index) => event.isLatest = (index === 0));
        document.getElementById('modal-tracking-number').textContent = data.trackingNumber;
        document.getElementById('modal-content').innerHTML = generateTrackingContent(data);
        showModal('tracking-modal');
    }

    function generateTrackingContent(data) {
        // This function dynamically builds the HTML for the tracking details modal
        // It remains largely the same as the previous version, focusing on displaying shipment data
        const timelineHTML = data.timeline.map(event => `
            <div class="relative pl-8 mb-6 border-l-2 ${event.isLatest ? 'border-fedex-orange' : 'border-gray-200'}">
                <div class="absolute -left-[11px] top-1 w-5 h-5 rounded-full ${event.isLatest ? 'bg-fedex-orange' : 'bg-fedex-green'}"></div>
                <p class="font-bold text-fedex-dark-gray">${event.status}</p>
                <p class="text-sm text-fedex-gray">${event.location}</p>
                <p class="text-xs text-fedex-gray">${event.date} at ${event.time}</p>
                <p class="text-sm mt-1">${event.description}</p>
            </div>`).join('');
        
        return `
            <div class="mb-6 p-6 bg-fedex-light-gray rounded-lg">
                <p class="text-lg font-bold text-fedex-purple">${data.status}</p>
                <p class="text-fedex-gray">Estimated Delivery: <span class="font-semibold">${data.estimatedDelivery}</span></p>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4"><div class="bg-fedex-green h-2.5 rounded-full" style="width: ${data.progress}%"></div></div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div><h3 class="text-xl font-bold mb-4">Shipment Timeline</h3>${timelineHTML}</div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Details</h3>
                    <div class="space-y-2">
                        <p><strong>From:</strong> ${data.sender.city}</p>
                        <p><strong>To:</strong> ${data.recipient.city}</p>
                        <p><strong>Service:</strong> ${data.service}</p>
                        <p><strong>Weight:</strong> ${data.weight}</p>
                    </div>
                </div>
            </div>
        `;
    }

    // --- ADMIN AUTHENTICATION & SECURITY ---
    function handleLogoClick() {
        AppState.logoClickCount++;
        if (AppState.logoClickCount === 3) {
            showModal('admin-login-modal');
            document.getElementById('login-error-msg').classList.add('hidden');
        }
        clearTimeout(AppState.logoClickTimer);
        AppState.logoClickTimer = setTimeout(() => { AppState.logoClickCount = 0; }, 600);
    }
    
    function handleAdminLogin(e) {
        e.preventDefault();
        const username = document.getElementById('admin-username').value;
        const password = document.getElementById('admin-password').value;
        if (username === AppState.adminCredentials.username && password === AppState.adminCredentials.password) {
            closeModal('admin-login-modal');
            showAdminDashboard();
        } else {
            document.getElementById('login-error-msg').classList.remove('hidden');
        }
    }

    function handleChangePassword(e) {
        e.preventDefault();
        const current = document.getElementById('current-password').value;
        const newPass = document.getElementById('new-password').value;
        const confirmPass = document.getElementById('confirm-password').value;

        if (current !== AppState.adminCredentials.password) {
            showNotification('Current password is incorrect.', 'error');
            return;
        }
        if (newPass !== confirmPass) {
            showNotification('New passwords do not match.', 'error');
            return;
        }
        if (newPass.length < 6) {
            showNotification('Password must be at least 6 characters long.', 'error');
            return;
        }

        AppState.adminCredentials.password = newPass;
        showNotification('Password updated successfully!', 'success');
        document.getElementById('password-change-form').reset();
    }


    // --- ADMIN DASHBOARD UI & CRUD ---
    function showAdminDashboard() {
        document.getElementById('admin-dashboard').style.display = 'block';
        renderAdminTable();
        showAdminSection('admin-shipments-section');
    }

    function hideAdminDashboard() {
        document.getElementById('admin-dashboard').style.display = 'none';
    }

    function showAdminSection(sectionId) {
        document.querySelectorAll('.admin-form-section').forEach(s => s.classList.remove('active'));
        document.getElementById(sectionId)?.classList.add('active');
        document.querySelectorAll('.admin-nav-button').forEach(b => b.classList.remove('active'));
        document.getElementById(`admin-nav-${sectionId.split('-')[1]}`)?.classList.add('active');
    }

    function renderAdminTable() {
        const tableBody = document.querySelector('#shipments-table tbody');
        tableBody.innerHTML = ''; // Clear existing rows
        Object.values(trackingDatabase).forEach(shipment => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="font-semibold">${shipment.trackingNumber}</td><td>${shipment.status}</td>
                <td>${shipment.sender.city}</td><td>${shipment.recipient.city}</td><td>${shipment.service}</td>
                <td class="space-x-4">
                    <button class="edit-btn text-fedex-blue hover:underline" data-id="${shipment.trackingNumber}">Edit</button>
                    <button class="delete-btn text-red-500 hover:underline" data-id="${shipment.trackingNumber}">Delete</button>
                </td>`;
            tableBody.appendChild(row);
        });
    }

    function showCreateForm() {
        document.getElementById('form-title').textContent = 'Create New Shipment';
        document.getElementById('shipment-form').innerHTML = generateFormHTML();
        document.getElementById('form-trackingNumber').disabled = false;
        document.getElementById('admin-table-view').classList.add('hidden');
        document.getElementById('admin-form-view').classList.remove('hidden');
    }

    function showEditForm(trackingNumber) {
        const data = trackingDatabase[trackingNumber];
        if (!data) return;
        document.getElementById('form-title').textContent = `Editing: ${trackingNumber}`;
        document.getElementById('shipment-form').innerHTML = generateFormHTML(data);
        document.getElementById('form-trackingNumber').disabled = true;
        document.getElementById('admin-table-view').classList.add('hidden');
        document.getElementById('admin-form-view').classList.remove('hidden');
    }
    
    function generateFormHTML(data = {}) {
        const sender = data.sender || {};
        const recipient = data.recipient || {};
        const timeline = data.timeline || [];
        
        return `
            <input type="hidden" id="edit-mode-tracking-number" value="${data.trackingNumber || ''}">
            <fieldset class="border p-4 rounded-lg"><legend class="font-bold text-fedex-purple px-2">Core Info</legend><div class="grid md:grid-cols-3 gap-4">
                <div><label class="admin-label">Tracking #</label><input type="text" id="form-trackingNumber" class="admin-input" value="${data.trackingNumber || ''}" required></div>
                <div><label class="admin-label">Status</label><input type="text" id="form-status" class="admin-input" value="${data.status || ''}" required></div>
                <div><label class="admin-label">Progress (%)</label><input type="number" id="form-progress" class="admin-input" value="${data.progress || 0}" required></div>
            </div></fieldset>
            <fieldset class="border p-4 rounded-lg"><legend class="font-bold text-fedex-purple px-2">Sender</legend><div class="grid md:grid-cols-2 gap-4">
                 <div><label class="admin-label">Name</label><input type="text" id="form-sender-name" class="admin-input" value="${sender.name || ''}"></div>
                 <div><label class="admin-label">City</label><input type="text" id="form-sender-city" class="admin-input" value="${sender.city || ''}"></div>
            </div></fieldset>
            <fieldset class="border p-4 rounded-lg"><legend class="font-bold text-fedex-purple px-2">Recipient</legend><div class="grid md:grid-cols-2 gap-4">
                 <div><label class="admin-label">Name</label><input type="text" id="form-recipient-name" class="admin-input" value="${recipient.name || ''}"></div>
                 <div><label class="admin-label">City</label><input type="text" id="form-recipient-city" class="admin-input" value="${recipient.city || ''}"></div>
            </div></fieldset>
            <div class="flex justify-end space-x-4">
                <button type="button" onclick="cancelForm()" class="border border-gray-400 text-gray-700 px-6 py-2 rounded-lg font-semibold">Cancel</button>
                <button type="submit" class="fedex-button text-white px-6 py-2 rounded-lg font-semibold">Save Shipment</button>
            </div>`;
    }
    
    function cancelForm() {
        document.getElementById('admin-table-view').classList.remove('hidden');
        document.getElementById('admin-form-view').classList.add('hidden');
    }

    function handleFormSubmit(e) {
        e.preventDefault();
        const trackingNumber = document.getElementById('form-trackingNumber').value.toUpperCase();
        if (!trackingNumber) { showNotification('Tracking number is required.', 'error'); return; }

        const isEdit = !!document.getElementById('edit-mode-tracking-number').value;
        const originalData = trackingDatabase[trackingNumber] || { timeline: [], sender: {}, recipient: {} };

        const updatedData = {
            ...originalData, // Preserve fields not in the simple form
            trackingNumber: trackingNumber,
            status: document.getElementById('form-status').value,
            progress: document.getElementById('form-progress').value,
            sender: { ...originalData.sender, name: document.getElementById('form-sender-name').value, city: document.getElementById('form-sender-city').value },
            recipient: { ...originalData.recipient, name: document.getElementById('form-recipient-name').value, city: document.getElementById('form-recipient-city').value },
        };
        trackingDatabase[trackingNumber] = updatedData;
        showNotification(`Shipment ${isEdit ? 'updated' : 'created'} successfully!`, 'success');
        renderAdminTable();
        cancelForm();
    }
    
    function deleteShipment(trackingNumber) {
        if (confirm(`Are you sure you want to delete shipment ${trackingNumber}?`)) {
            delete trackingDatabase[trackingNumber];
            showNotification(`Shipment ${trackingNumber} deleted.`, 'success');
            renderAdminTable();
        }
    }


    // --- EVENT LISTENERS SETUP ---
    document.addEventListener('DOMContentLoaded', () => {
        // Main Tracking Form
        document.getElementById('tracking-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const trackingNumber = document.getElementById('tracking-number').value.trim();
            trackPackage(trackingNumber) || showNotification('Tracking number not found.', 'error');
        });

        // Admin Auth
        document.getElementById('admin-login-form').addEventListener('submit', handleAdminLogin);
        document.getElementById('password-change-form').addEventListener('submit', handleChangePassword);

        // Admin CRUD
        document.getElementById('show-create-form-btn').addEventListener('click', showCreateForm);
        document.getElementById('shipments-table').addEventListener('click', (e) => {
            const editBtn = e.target.closest('.edit-btn');
            const deleteBtn = e.target.closest('.delete-btn');
            if (editBtn) showEditForm(editBtn.dataset.id);
            if (deleteBtn) deleteShipment(deleteBtn.dataset.id);
        });
        document.getElementById('shipment-form').addEventListener('submit', handleFormSubmit);
    });
    
    // Make key functions globally accessible for inline `onclick` attributes
    window.showModal = showModal;
    window.closeModal = closeModal;
    window.showPage = showPage;
    window.handleLogoClick = handleLogoClick;
    window.showAdminSection = showAdminSection;
    window.cancelForm = cancelForm;

  </script>

</body></html>
