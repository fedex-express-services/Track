<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Track Packages - FedEx</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'fedex-purple': '#4D148C',
            'fedex-orange': '#FF6200',
            'fedex-gray': '#767676',
            'fedex-light-gray': '#F5F5F5',
            'fedex-dark-gray': '#333333',
            'fedex-blue': '#0071CE',
            'fedex-green': '#6CBF00'
          },
          fontFamily: {
            'fedex': ['Source Sans Pro', 'Arial', 'sans-serif']
          }
        }
      }
    }
  </script>

  <style>
    * { font-family: 'Source Sans Pro', Arial, sans-serif; }
    .fedex-shadow { box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .fedex-button { background: #4D148C; transition: all 0.3s ease; }
    .fedex-button:hover { background: #3D0F6B; transform: translateY(-1px); }
    .progress-bar { background: linear-gradient(90deg, #FF6200, #4D148C); transition: width 2s ease-in-out; }
    .modal, .page-section { display: none; }
    .modal.active, .page-section.active { display: flex; }
    .modal-backdrop { backdrop-filter: blur(4px); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 0.5s ease-out; }
    .timeline-dot { width: 12px; height: 12px; border-radius: 50%; position: absolute; left: -6px; top: 6px; }
    .timeline-line { width: 2px; background: #E5E7EB; position: absolute; left: -1px; top: 18px; bottom: -18px; }
    .timeline-item:last-child .timeline-line { display: none; }
    
    .notification { position: fixed; top: 20px; right: 20px; padding: 1rem 1.5rem; border-radius: 8px; color: white; font-weight: 600; z-index: 10001; animation: slideInRight 0.5s ease-out; }
    .notification.success { background: #059669; }
    .notification.error { background: #DC2626; }
    @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); } }

    .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #FF6200; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Admin Dashboard Styles */
    #admin-dashboard { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #F5F5F5; z-index: 9999; overflow-y: auto; display: none; }
    .admin-form-section { display: none; }
    .admin-form-section.active { display: block; animation: fadeIn 0.5s ease-out; }
    .admin-table { width: 100%; min-width: 800px; border-collapse: collapse; }
    .admin-table th, .admin-table td { padding: 12px 16px; border-bottom: 1px solid #ddd; text-align: left; }
    .admin-table th { background-color: #e9e9e9; font-weight: 600; color: #333; }
    .admin-input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
    .admin-nav-button { padding: 10px 20px; border-radius: 8px 8px 0 0; font-weight: 600; cursor: pointer; }
    .admin-nav-button.active { background-color: #4D148C; color: white; }
  </style>
</head>

<body class="bg-white font-fedex">
  <!-- Header -->
  <header class="bg-white border-b border-gray-200 sticky top-0 z-40">
    <div class="bg-fedex-purple text-white py-1">
      <div class="max-w-7xl mx-auto px-4 flex justify-between items-center text-sm">
        <span>United States | English</span>
        <div class="space-x-4">
          <a href="#" class="hover:text-fedex-orange" onclick="showModal('support-modal')">Support</a>
          <a href="#" class="hover:text-fedex-orange" onclick="showModal('contact-modal')">Contact</a>
          <a href="#" class="hover:text-fedex-orange" onclick="showModal('locations-modal')">Locations</a>
        </div>
      </div>
    </div>
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div id="fedex-logo" class="flex items-center cursor-pointer">
          <div class="bg-fedex-purple text-white px-3 py-2 font-bold text-2xl">Fed</div>
          <div class="bg-fedex-orange text-white px-3 py-2 font-bold text-2xl">Ex</div>
        </div>
        <nav class="hidden lg:flex space-x-8">
          <a href="#" class="text-fedex-dark-gray hover:text-fedex-purple font-semibold" onclick="showModal('ship-modal')">Ship</a>
          <a href="#" class="text-fedex-purple font-semibold border-b-2 border-fedex-orange pb-3" onclick="showPage('main-page')">Track</a>
          <a href="#" class="text-fedex-dark-gray hover:text-fedex-purple font-semibold" onclick="showModal('manage-modal')">Manage</a>
          <a href="#" class="text-fedex-dark-gray hover:text-fedex-purple font-semibold" onclick="showModal('support-modal')">Support</a>
        </nav>
        <button class="lg:hidden p-2"><i class="fas fa-bars text-2xl text-fedex-dark-gray"></i></button>
      </div>
    </div>
  </header>
  
  <div id="main-page" class="page-section active">
      <main class="min-h-screen bg-fedex-light-gray">
        <section class="bg-white py-12">
          <div class="max-w-6xl mx-auto px-4">
            <div class="text-center mb-8">
              <h1 class="text-4xl font-bold text-fedex-dark-gray mb-4">Track Your Package</h1>
              <p class="text-xl text-fedex-gray">Enter your tracking number to get real-time updates</p>
            </div>
            <div class="max-w-2xl mx-auto">
              <div class="bg-white border border-gray-200 rounded-lg fedex-shadow p-6">
                <form id="tracking-form">
                  <div class="relative">
                    <input type="text" name="tracking-number" required class="w-full px-4 py-4 text-lg border-2 border-gray-300 rounded-lg focus:border-fedex-purple focus:outline-none" placeholder="Enter tracking number">
                    <button type="submit" id="track-button" class="absolute right-2 top-2 fedex-button text-white px-6 py-2 rounded-lg font-semibold">
                      <span id="track-text">Track</span>
                      <span id="track-loading" class="hidden"><div class="loading-spinner"></div></span>
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </section>
        <section class="py-12">
          <div class="max-w-6xl mx-auto px-4">
            <h2 class="text-3xl font-bold text-fedex-dark-gray text-center mb-8">Our Services</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="bg-white rounded-lg fedex-shadow p-6 text-center cursor-pointer" onclick="showModal('ship-modal')">
                <i class="fas fa-shipping-fast text-fedex-purple text-4xl mb-4"></i>
                <h3 class="text-xl font-bold text-fedex-dark-gray mb-2">Ship</h3>
                <p class="text-fedex-gray">Create shipping labels and schedule pickups</p>
              </div>
              <div class="bg-white rounded-lg fedex-shadow p-6 text-center cursor-pointer" onclick="showPage('main-page')">
                <i class="fas fa-search text-fedex-orange text-4xl mb-4"></i>
                <h3 class="text-xl font-bold text-fedex-dark-gray mb-2">Track</h3>
                <p class="text-fedex-gray">Monitor your shipments in real-time</p>
              </div>
              <div class="bg-white rounded-lg fedex-shadow p-6 text-center cursor-pointer" onclick="showModal('manage-modal')">
                <i class="fas fa-cog text-fedex-blue text-4xl mb-4"></i>
                <h3 class="text-xl font-bold text-fedex-dark-gray mb-2">Manage</h3>
                <p class="text-fedex-gray">Access your shipping history and preferences</p>
              </div>
            </div>
          </div>
        </section>
      </main>
  </div>

  <!-- Tracking Modal -->
  <div id="tracking-modal" class="modal fixed inset-0 bg-black bg-opacity-50 modal-backdrop items-center justify-center z-50 p-2">
    <div class="bg-white rounded-lg w-full max-w-7xl max-h-[95vh] overflow-y-auto animate-fade-in">
      <div class="bg-fedex-purple text-white p-6 rounded-t-lg sticky top-0 z-10 flex justify-between items-center">
        <div>
          <h2 class="text-2xl font-bold">Tracking Details</h2>
          <p class="text-fedex-orange font-semibold" id="modal-tracking-number"></p>
        </div>
        <button id="close-tracking-modal" class="text-2xl"><i class="fas fa-times"></i></button>
      </div>
      <div class="p-8" id="modal-content"></div>
    </div>
  </div>
  
  <!-- Container for all other dynamically generated modals -->
  <div id="generic-modal-container"></div>
  
  <!-- Admin Login Modal -->
  <div id="admin-login-modal" class="modal fixed inset-0 bg-black bg-opacity-50 modal-backdrop items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg max-w-sm w-full animate-fade-in shadow-xl">
        <div class="p-6 border-b"><h2 class="text-2xl font-bold text-fedex-purple text-center">Admin Login</h2></div>
        <form id="admin-login-form" class="p-8 space-y-6">
            <div><label for="admin-username" class="font-bold">Username</label><input type="text" id="admin-username" class="admin-input mt-1" required></div>
            <div><label for="admin-password" class="font-bold">Password</label><input type="password" id="admin-password" class="admin-input mt-1" required></div>
            <p id="login-error-msg" class="text-red-500 text-sm hidden">Invalid credentials.</p>
            <div class="flex space-x-4">
                 <button type="button" id="cancel-login-btn" class="w-1/2 border border-gray-400 py-3 rounded-lg font-bold">Cancel</button>
                <button type="submit" class="w-1/2 fedex-button py-3 rounded-lg font-bold">Login</button>
            </div>
        </form>
    </div>
  </div>

  <!-- ADMIN DASHBOARD -->
  <div id="admin-dashboard">
    <div class="p-4 sm:p-8 max-w-7xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-fedex-purple">Admin Dashboard</h1>
            <button id="close-admin-btn" class="text-2xl text-gray-500 hover:text-fedex-orange">×</button>
        </div>
        <div class="flex space-x-2 mb-8 border-b">
            <button id="admin-nav-shipments" class="admin-nav-button active" onclick="showAdminSection('admin-shipments-section')">Shipments</button>
            <button id="admin-nav-security" class="admin-nav-button" onclick="showAdminSection('admin-security-section')">Security</button>
        </div>
        <div id="admin-shipments-section" class="admin-form-section active"></div>
        <div id="admin-security-section" class="admin-form-section">
             <div class="bg-white rounded-lg shadow-md p-8 max-w-lg mx-auto">
                <form id="password-change-form" class="space-y-6">
                    <h2 class="text-2xl font-bold text-fedex-dark-gray">Change Password</h2>
                    <div><label for="current-password" class="font-bold">Current Password</label><input type="password" id="current-password" class="admin-input mt-1" required></div>
                    <div><label for="new-password" class="font-bold">New Password</label><input type="password" id="new-password" class="admin-input mt-1" required></div>
                    <div><label for="confirm-password" class="font-bold">Confirm New Password</label><input type="password" id="confirm-password" class="admin-input mt-1" required></div>
                    <button type="submit" class="w-full fedex-button py-3 rounded-lg font-bold">Update Password</button>
                </form>
            </div>
        </div>
    </div>
  </div>
  
  <!-- Footer -->
  <footer class="bg-fedex-dark-gray text-white py-12">
    <div class="max-w-6xl mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h4 class="font-bold text-lg mb-4">Our Company</h4>
          <ul class="space-y-2 text-gray-300">
            <li><a href="#" class="hover:text-fedex-orange" onclick="showModal('about-modal')">About FedEx</a></li>
            <li><a href="#" class="hover:text-fedex-orange" onclick="showModal('investors-modal')">Investor Relations</a></li>
            <li><a href="#" class="hover:text-fedex-orange" onclick="showModal('careers-modal')">Careers</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-bold text-lg mb-4">Support</h4>
          <ul class="space-y-2 text-gray-300">
            <li><a href="#" class="hover:text-fedex-orange" onclick="showModal('support-modal')">Customer Support</a></li>
            <li><a href="#" class="hover:text-fedex-orange" onclick="showModal('locations-modal')">Find Locations</a></li>
          </ul>
        </div>
      </div>
      <div class="border-t border-gray-600 mt-8 pt-8 text-center">
        <p class="text-gray-300">© 2025 FedEx. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    // --- APPLICATION STATE & DATABASE ---
    const AppState = {
        adminCredentials: { username: 'admin', password: 'admin111' },
        logoClickCount: 0,
        logoClickTimer: null
    };

    const trackingDatabase = {
      'FD26031998KR': {
        trackingNumber: 'FD26031998KR', status: 'Awaiting Clearance', service: 'FedEx International Priority', estimatedDelivery: 'Pending approval', shipDate: 'Aug 1, 2025', weight: '2,840 lbs', progress: 20,
        sender: { name: 'K. Reeves', city: 'Paris, FR' }, 
        recipient: { name: 'K. Dinanauth', city: 'Conway, SC' },
        timeline: [
          { status: 'Awaiting recipient clearance', location: 'PARIS, FR', date: 'Aug 1, 2025', time: '1:45 PM', description: 'Package requires clearance before shipping.'},
          { status: 'Registered at facility', location: 'PARIS, FR', date: 'Aug 1, 2025', time: '1:40 PM', description: 'Package registered and secured.'}
        ]
      }
    };
    
    const modalContent = {
        'ship-modal': {title: 'Shipping Services', content: 'Our shipping services provide reliable, time-definite delivery to more than 220 countries and territories.'},
        'manage-modal': {title: 'Manage Your Account', content: 'From your account dashboard, you can view shipping history, manage addresses, and set delivery preferences.'},
        'support-modal': {title: 'Customer Support', content: 'Our dedicated support team is here to help you 24/7. Call us at 1-800-GO-FEDEX for any questions.'},
        'contact-modal': {title: 'Contact Information', content: 'For general inquiries, please visit our support page or call our customer service line.'},
        'locations-modal': {title: 'Find Locations', content: 'With thousands of locations, you can easily find a FedEx Office, Ship Center, or drop box near you.'},
        'about-modal': {title: 'About FedEx', content: 'FedEx Corp. provides customers and businesses worldwide with a broad portfolio of transportation, e-commerce and business services.'},
        'investors-modal': {title: 'Investor Relations', content: 'Access financial reports, earnings information, and resources for FedEx Corporation investors.'},
        'careers-modal': {title: 'Careers at FedEx', content: 'Join a team that connects people and possibilities around the world.'},
    };

    // --- UTILITY & CORE FUNCTIONS ---
    function showNotification(message, type = 'info') {
      const n = document.createElement('div');
      n.className = `notification ${type}`;
      n.innerHTML = `<span>${message}</span>`;
      document.body.appendChild(n);
      setTimeout(() => n.remove(), 4000);
    }
    
    function showModal(modalId) {
        const data = modalContent[modalId];
        if (!data) return;
        const container = document.getElementById('generic-modal-container');
        container.innerHTML = `<div id="${modalId}" class="modal active fixed inset-0 bg-black bg-opacity-50 modal-backdrop items-center justify-center z-50 p-4">
                <div class="bg-white rounded-lg max-w-xl w-full animate-fade-in shadow-xl">
                    <div class="p-6 flex justify-between items-center border-b">
                        <h2 class="text-2xl font-bold text-fedex-purple">${data.title}</h2>
                        <button onclick="closeDynamicModal('${modalId}')" class="text-2xl text-gray-500">×</button>
                    </div>
                    <div class="p-8"><p>${data.content}</p></div>
                </div></div>`;
    }

    function closeDynamicModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) modal.remove();
    }
    
    function showPage(pageId) {
        document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId)?.classList.add('active');
    }

    // --- FRONTEND TRACKING ---
    function trackPackage(trackingNumber) {
      const data = trackingDatabase[trackingNumber.toUpperCase()];
      if (data) {
        displayTrackingModal(data);
        return true;
      }
      return false;
    }

    function displayTrackingModal(data) {
        data.timeline.forEach((event, index) => event.isLatest = (index === 0));
        document.getElementById('modal-tracking-number').textContent = data.trackingNumber;
        document.getElementById('modal-content').innerHTML = `
            <div class="mb-6 p-6 bg-fedex-light-gray rounded-lg">
                <p class="text-2xl font-bold text-fedex-purple">${data.status}</p>
                <div class="w-full bg-gray-300 rounded-full h-2.5 mt-4"><div class="bg-fedex-green h-2.5 rounded-full" style="width: ${data.progress}%"></div></div>
            </div>
            <div>
                <h3 class="text-xl font-bold mb-4">Travel History</h3>
                ${data.timeline.map(event => `<div class="relative pl-8 mb-8 border-l-2 ${event.isLatest ? 'border-fedex-orange' : 'border-gray-300'}">
                        <div class="absolute -left-[11px] top-1 w-5 h-5 rounded-full ${event.isLatest ? 'bg-fedex-orange ring-4 ring-orange-200' : 'bg-fedex-green'}"></div>
                        <p class="font-bold text-fedex-dark-gray">${event.status}</p>
                        <p class="text-sm text-fedex-gray">${event.location}</p>
                        <p class="text-xs text-fedex-gray">${event.date}, ${event.time}</p>
                        <p class="text-sm mt-1">${event.description}</p>
                    </div>`).join('')}
            </div>`;
        document.getElementById('tracking-modal').classList.add('active');
    }

    // --- ADMIN AUTH & SECURITY ---
    function handleLogoClick() {
        AppState.logoClickCount++;
        if (AppState.logoClickCount === 3) {
            document.getElementById('admin-login-modal').classList.add('active');
        }
        clearTimeout(AppState.logoClickTimer);
        AppState.logoClickTimer = setTimeout(() => { AppState.logoClickCount = 0; }, 600);
    }
    
    function handleAdminLogin(e) {
        e.preventDefault();
        if (e.target.username.value === AppState.adminCredentials.username && e.target.password.value === AppState.adminCredentials.password) {
            document.getElementById('admin-login-modal').classList.remove('active');
            showAdminDashboard();
        } else {
            document.getElementById('login-error-msg').classList.remove('hidden');
        }
    }

    function handleChangePassword(e) {
        e.preventDefault();
        const form = e.target;
        const current = form['current-password'].value, newPass = form['new-password'].value;
        if (current !== AppState.adminCredentials.password) return showNotification('Current password is incorrect.', 'error');
        if (newPass !== form['confirm-password'].value) return showNotification('New passwords do not match.', 'error');
        AppState.adminCredentials.password = newPass;
        showNotification('Password updated successfully!', 'success');
        form.reset();
    }

    // --- ADMIN DASHBOARD UI & CRUD ---
    function showAdminDashboard() { document.getElementById('admin-dashboard').style.display = 'block'; renderAdminShipmentsView('table'); }
    function hideAdminDashboard() { document.getElementById('admin-dashboard').style.display = 'none'; }
    function showAdminSection(sectionId) {
        document.querySelectorAll('.admin-form-section').forEach(s => s.classList.remove('active'));
        document.getElementById(sectionId)?.classList.add('active');
        document.querySelectorAll('.admin-nav-button').forEach(b => b.classList.remove('active'));
        document.getElementById(`admin-nav-${sectionId.split('-')[1]}`)?.classList.add('active');
    }
    function renderAdminShipmentsView(view = 'table', trackingNumber = null) {
        const container = document.getElementById('admin-shipments-section');
        if (view === 'table') {
            container.innerHTML = `<div id="admin-table-view">
                <div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold">All Shipments</h2><button onclick="renderAdminShipmentsView('form')" class="fedex-button font-bold py-2 px-4 rounded-lg"><i class="fas fa-plus mr-2"></i>Create Shipment</button></div>
                <div class="bg-white rounded-lg shadow-md p-4 overflow-x-auto"><table class="w-full min-w-[600px]" id="shipments-table"><thead><tr class="text-left"><th>Tracking #</th><th>Status</th><th>From</th><th>To</th><th>Actions</th></tr></thead><tbody></tbody></table></div>
            </div>`;
            const tableBody = container.querySelector('tbody');
            Object.values(trackingDatabase).forEach(shipment => {
                const row = document.createElement('tr');
                row.innerHTML = `<td class="py-2 border-b font-bold">${shipment.trackingNumber}</td><td class="py-2 border-b">${shipment.status}</td><td class="py-2 border-b">${shipment.sender.city}</td><td class="py-2 border-b">${shipment.recipient.city}</td>
                <td class="py-2 border-b space-x-4"><button class="text-fedex-blue font-bold" onclick="renderAdminShipmentsView('form', '${shipment.trackingNumber}')">Edit</button><button class="text-red-600 font-bold" onclick="deleteShipment('${shipment.trackingNumber}')">Delete</button></td>`;
                tableBody.appendChild(row);
            });
        } else if (view === 'form') {
            const data = trackingNumber ? trackingDatabase[trackingNumber] : {};
            container.innerHTML = `<div id="admin-form-view">
                <h2 class="text-2xl font-bold mb-6">${trackingNumber ? 'Edit' : 'Create'} Shipment</h2>
                <form id="shipment-form" class="bg-white rounded-lg shadow-md p-8 space-y-6">
                    <input type="hidden" name="isEdit" value="${trackingNumber || ''}">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div><label class="font-bold">Tracking #</label><input type="text" name="trackingNumber" class="admin-input mt-1" value="${data.trackingNumber || ''}" ${trackingNumber ? 'disabled' : ''}></div>
                        <div><label class="font-bold">Status</label><input type="text" name="status" class="admin-input mt-1" value="${data.status || ''}"></div>
                        <div><label class="font-bold">Progress (%)</label><input type="number" name="progress" class="admin-input mt-1" value="${data.progress || 0}"></div>
                        <div><label class="font-bold">Sender City</label><input type="text" name="senderCity" class="admin-input mt-1" value="${data.sender?.city || ''}"></div>
                        <div><label class="font-bold">Recipient City</label><input type="text" name="recipientCity" class="admin-input mt-1" value="${data.recipient?.city || ''}"></div>
                    </div>
                    <div class="flex justify-end space-x-4"><button type="button" onclick="renderAdminShipmentsView('table')" class="border border-gray-400 font-bold py-2 px-6 rounded-lg">Cancel</button><button type="submit" class="fedex-button font-bold py-2 px-6 rounded-lg">Save</button></div>
                </form>
            </div>`;
            container.querySelector('#shipment-form').addEventListener('submit', handleFormSubmit);
        }
    }
    function handleFormSubmit(e) {
        e.preventDefault();
        const form = e.target;
        const trackingNumber = (form.isEdit.value || form.trackingNumber.value).toUpperCase();
        if (!trackingNumber) return showNotification('Tracking number is required.', 'error');
        const isEdit = !!form.isEdit.value;
        const originalData = trackingDatabase[trackingNumber] || { sender:{}, recipient:{}, timeline:[] };
        
        // Add a default timeline event if creating a new shipment
        if (!isEdit && originalData.timeline.length === 0) {
            originalData.timeline.push({
                status: 'Shipment information sent to FedEx',
                location: 'SYSTEM',
                date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric'}),
                time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit'}),
                description: 'A new shipment has been created.'
            });
        }

        trackingDatabase[trackingNumber] = {
            ...originalData,
            trackingNumber: trackingNumber,
            status: form.status.value,
            progress: form.progress.value,
            sender: { ...originalData.sender, city: form.senderCity.value },
            recipient: { ...originalData.recipient, city: form.recipientCity.value }
        };
        showNotification(`Shipment ${isEdit ? 'updated' : 'created'}!`, 'success');
        renderAdminShipmentsView('table');
    }
    function deleteShipment(trackingNumber) {
        if (confirm(`Delete shipment ${trackingNumber}?`)) {
            delete trackingDatabase[trackingNumber];
            showNotification('Shipment deleted.', 'success');
            renderAdminShipmentsView('table');
        }
    }

    // --- EVENT LISTENERS SETUP ---
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('fedex-logo').addEventListener('click', handleLogoClick);
        document.getElementById('tracking-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('#track-button');
            const text = e.target.querySelector('#track-text');
            const loading = e.target.querySelector('#track-loading');
            const trackingNum = e.target['tracking-number'].value.trim();

            if (!trackingNum) return showNotification('Please enter a tracking number.', 'error');
            
            text.classList.add('hidden');
            loading.classList.remove('hidden');
            btn.disabled = true;

            setTimeout(() => {
                trackPackage(trackingNum) || showNotification('Tracking number not found.', 'error');
                text.classList.remove('hidden');
                loading.classList.add('hidden');
                btn.disabled = false;
            }, 1000);
        });
        document.getElementById('close-tracking-modal').addEventListener('click', () => document.getElementById('tracking-modal').classList.remove('active'));
        document.getElementById('admin-login-form').addEventListener('submit', handleAdminLogin);
        document.getElementById('cancel-login-btn').addEventListener('click', () => document.getElementById('admin-login-modal').classList.remove('active'));
        document.getElementById('password-change-form').addEventListener('submit', handleChangePassword);
        document.getElementById('close-admin-btn').addEventListener('click', hideAdminDashboard);
    });
    
    // --- GLOBAL ACCESS FOR ONCLICK ---
    window.showModal = showModal; window.closeDynamicModal = closeDynamicModal; window.showPage = showPage;
    window.showAdminSection = showAdminSection; window.renderAdminShipmentsView = renderAdminShipmentsView; window.deleteShipment = deleteShipment;
  </script>

</body></html>
